const game = {};

// VARIABLES
game.gameState = false;
game.players = players;
game.questions = [];
game.questionCurrent = [];
game.questionMax = players.length;
game.questionsAnswered = 0;
game.questionsCorrect = 0;
// METHODS
game.startGame = function() {
  console.log('game started');
  // fetch the next question
  // populate the question in the game container
}

game.getRandomIdx = function(array) {
  const idx = Math.floor(Math.random() * array.length);
  return idx;
}


game.getRandomNames = function(notIdx) {
  // make a copy of the players array
  const players = game.players.slice();
  
  // remove the players name from the copy of the players array
  players.splice(notIdx, 1);
  
  // create an array to hold the player names
  const playerNames = [];
  
  for (let i = 0; i < 3; i++) {
    // get a random index of the functions players array
    const randomIdx = game.getRandomIdx(players);
    // push name of player at the random index of the players array
    playerNames.push(players[randomIdx].name);
    // remove that name from the players array
    players.splice(randomIdx, 1);
  }
  
  // return the 3 randomly selected names
  return playerNames; 
}

game.populateQuestions = function() {
  // make a copy of the players array
  const questions = game.players.slice();

  questions.forEach(function(question, idx) {
    // for each player object, create new gameNames property
    // add the player's name and 3 random player's names to be guessed
    question.gameNames = [question.name].concat(game.getRandomNames(idx));
  })

  // set the game.questions property to the questions generated by this function
  game.questions = questions;
}

game.displayQuestion = function() {
  const question = game.questionCurrent;
  // Display player's image
  $('.game__playerImg').attr('src', question.imgSrc);

  // Display question count
  $('.game__questionNumber').text(`${game.questionsAnswered + 1} / ${game.questionMax}`);
  
  // Display name options
  $('.game__form label').each(function(idx) {
    const playerName = question.gameNames[idx];
    const labelFor = $(this).attr('for');
    
    // Set label text to playerName
    $(this).text(playerName);

    // Set input value to playerName
    $(`#${labelFor}`).attr('value', playerName);
  })
}

game.getNextQuestion = function() {
  const randomIdx = game.getRandomIdx(game.questions);

  game.questionCurrent = game.questions.splice(randomIdx, 1)[0];
}

// EVENT LISTENERS
game.handleSubmit = $('form').on('submit', function(evt) {
  evt.preventDefault();

  // Get value of the selected answer
  const userAnswer = $('form input[name="player"]:checked').val();
  
  // If userAnswer has a value and its value is not "on"
  if (userAnswer && userAnswer !== "on") {
    console.log('user answer:', userAnswer);
    console.log('correct answer: ', game.questionCurrent.name)
    console.log('next question')
    
    // Remove checked property of selected answer
    $('.game__form input[name="player"]:checked').prop("checked", false);
    
    // Increment questionsAnswered counter
    game.questionsAnswered++;

    // Get next question
    game.getNextQuestion();
    // Display the next question
    game.displayQuestion();

  } else {
    console.log('question must be answered to move forward')
  }
});

// DOCUMENT READY
$(function() {
  console.log("document ready");

  console.log("populating questions");
  game.populateQuestions();

  game.getNextQuestion();
  console.log("Displaying next question");
  game.displayQuestion();
});